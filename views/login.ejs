<html lang="ja">
    <head>
        <meta charset="UTF-8">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <link rel="stylesheet" href="../assets/css/style.css">
        <title>なんでも掲示板</title>
    </head>
    <body>
        <header>
            <div class="header_inner">
                <h1><a href="/">なんでも掲示板</a></h1>
                <nav id="js_nav">
                    <ul>
                        <li>ようこそ&nbsp;ゲストさん</li>
                        <li><a href="/new">新規スレッドを書く</a></li>
                        <li><a href="/login">ログイン</a></li>
                        <li><a href="/register">新規ユーザー登録</a></li>
                        <li><a id="board_search">掲示板検索</a></li><!-- 押すと下の検索ボックスが現れる -->
                        <li><input type="text" placeholder="検索" id="board_search_box"></li>
                        <!-- <li><a href="/favorite">お気に入り一覧</a></li>ログインユーザーのみ -->
                    </ul>
                </nav>
                <button class="header_hamburger hamburger" id="js_hamburger">
                    <span></span><span></span><span></span>
                </button>
            </div>
        </header>
        <main>
            <div class="container">
                <section class="login">
                    <form class="login_form" action="/" method="post">
                        <h2>ユーザーログイン</h2>
                        <p id="alert_message"></p>
                        <label for="email">ID(メールアドレス)</label><input type="text" id="email" name="email" />
                        <p id="email_alert"></p>
                        <label for="password">パスワード</label><input type="password" id="password" name="password" />
                        <p id="password_alert"></p>
                        <button class="btn" id="login_btn" type="button">ログイン</button>
                        <p><a href="">新規ユーザー登録はこちら</a></p>
                    </form>
                </section>
            </div>
        </main>
        <footer>
            <div class="container"><small>&copy;2024 message-board.All Rights Reserved.</small></div>
        </footer>
    </body>
    <script>
        const ham = document.getElementById("js_hamburger");
        const nav = document.getElementById("js_nav");
        ham.addEventListener("click", function () {
            ham.classList.toggle("active")
            nav.classList.toggle("active")
        })
        const board_search = document.getElementById("board_search");
        const box = document.getElementById("board_search_box");
        board_search.addEventListener("click", function () {
            box.classList.toggle("active")
        })
        //空欄チェック
        //DBと照合
        const login_btn = document.getElementById("login_btn");
        login_btn.addEventListener("click", function (e) {
            e.preventDefault();
            login()
        })
        async function login() {
            const email = document.getElementById("email");
            const password = document.getElementById("password");
            const alert_message = document.getElementById("alert_message");
            const email_alert = document.getElementById("email_alert");
            const password_alert = document.getElementById("password_alert");
            let isValid = true;
            if (!email.value) {
                email_alert.innerHTML = "入力してください";
                email_alert.style.color = "red";
                email.style.borderColor = "red";
                isValid = false;
            } else {
                email_alert.innerHTML = "";
                email_alert.style.color = "#444";
                email.style.borderColor = "#444";
            }
            if (!password.value) {
                password_alert.innerHTML = "入力してください";
                password_alert.style.color = "red";
                password.style.borderColor = "red";
                isValid = false;
            } else {
                password_alert.innerHTML = "";
                password_alert.style.color = "#444";
                password.style.borderColor = "#444";
            }
            if (!isValid) {
                return;
            }
            try {
                const res = await fetch(`/fetch_login`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({ email: email.value, password: password.value })
                });
                const data = await res.json();
                if (res.ok) {
                    if (data.success) {
                        document.querySelector(".login_form").submit();
                        window.location.href = "/"
                    }
                    else {
                        email.style.borderColor = "red"
                        password.style.borderColor = "red"
                        alert_message.style.color = "red"
                        alert_message.innerHTML = data.error || ""
                        isValid = false;
                    }
                } else {
                    alert_message.innerHTML = data.error || "サーバーエラーが発生しました"
                    alert_message.style.color = "red"
                    isValid = false;
                }
            }
            catch (error) {
                console.error("Error:", error)
                isValid = false;
            }
        }
    </script>
</html>
